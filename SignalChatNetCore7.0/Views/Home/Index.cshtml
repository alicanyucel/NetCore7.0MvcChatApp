@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <<div class="container">
        <div class="row">
            <div class="col-4">
                <input type="text" class="form-control" id="message" placeholder="mesajı yazınız" /><br/>
                <input type="text" id="userName" class="form-control" />
                <br />
                <button class="btn btn-primary" type="button" id="btnSendMessage">Mesaj Gönder</button>
            </div>
            <div class="col-8">
                <ul class="list-group" id="messages"></ul>
            </div>
        </div>
    </div>

</div>

@section Scripts{
<script>
    const connection=new signalR.HubConnectionBuilder().withUrl("/chatHub").configureLogging(signalR.LogLevel.Information).build();
    async function start(){
        try{
        await connection.start();
        console.log("signalr connected");
        // test edildi socket çalışıyor
        }
        catch(err){
            console.error(err);
            setTimeout(start,5000);
        }

    }
    connection.onclose(async()=>{
        await start();
    });
    start();
    $('#btnSendMessage').click(function() {
        try{
            var kulaniciAdi=$('#userName').val();
            var message=$('#message').val();
            connection.invoke("SendMessage",kullaniciAdi
            ,message);
        }
        catch(err){
            console.error(err);
        }
    });
    $().ready(function(){
       connection.on("ReceiveMessage",(user,message)=>{
           console.log(user,message);
           $('#messages').append(
               `<li class="list-group-item">${user}:${message}`
           )
       });
    });
</script>
}